<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">
    <context:property-placeholder local-override="true" properties-ref="yamlProperties"/>
    <context:component-scan base-package="com.stevejrong.music.factory.config,com.stevejrong.music.factory.provider.service"/>

    <!-- 系统基础配置 -->
    <bean id="baseConfig" class="com.stevejrong.music.factory.config.sub.BaseConfig" lazy-init="false">
        <!-- Spring配置文件的文件名称 -->
        <property name="springConfigurationFileName" value="application-bean.xml"/>
        <property name="welcomeMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
当前用户配置信息：&#x000A;{{currentCustomConfigInfo}}&#x000A;
[1] 自定义原始音频文件的存放位置。&#x000A;
[2] 分析指定目录下的音频文件，并补全音频文件元数据信息。&#x000A;
[3] 自定义转换格式后的音频文件存放位置。&#x000A;
[4] 批量转换指定目录下的音频文件格式。&#x000A;
[0] 退出程序。&#x000A;&#x000A;
输入上述数字序号来执行任务：_"/>

        <property name="customAudioFileDirectoryMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 自定义原始音频文件存放目录 =============================== &#x000A;
当前原始音频文件存放目录为：{{defaultAudioFileDirectory}}。&#x000A;
将原始音频文件的根文件夹直接拖动或从地址栏粘贴至此处，并按[Enter]键应用设置，输入[N]或[n]以退出当前选项：_"/>

        <property name="customAudioFileDirectorySuccessMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 自定义原始音频文件存放目录成功 =============================== &#x000A;
原始音频文件的存放目录，已由{{oldAudioFileDirectory}}成功地更改为了{{newAudioFileDirectory}}。&#x000A;"/>

        <property name="customConvertedAudioFileDirectoryMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 自定义转换格式后的音频文件存放目录 =============================== &#x000A;
当前转换格式后的音频文件存放目录为：{{defaultConvertedAudioFileDirectory}}。&#x000A;
将转换格式后的音频文件文件夹直接拖动或从地址栏粘贴至此处，并按[Enter]键应用设置，输入[N]或[n]以退出当前选项：_"/>

        <property name="customConvertedAudioFileDirectorySuccessMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 自定义转换格式后的音频文件存放目录成功 =============================== &#x000A;
转换格式后的音频文件存放目录，已由{{oldConvertedAudioFileDirectory}}成功地更改为了{{newConvertedAudioFileDirectory}}。&#x000A;"/>

        <property name="analyzingCompletedForAudioFileMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 您的音频文件全部分析完成 =============================== &#x000A;
您有{{audioFileCountForNeedComplements}}个音频文件需要补全元数据信息。&#x000A;
输入[Y]或[y]以补全缺失的音频文件元数据信息，输入[N]或[n]以退出当前选项：_"/>

        <property name="metadataInfoCompletedForAudioFileMessage" value="
&#x000A;&#x000A; =============================== 欢迎使用Music Factory =============================== &#x000A;
=============================== 您的音频文件元数据全部补全完成 =============================== &#x000A;
此次共补全{{audioFileTotalCountForMetadataInfoCompleted}}个音频文件的元数据信息：&#x000A;
√ 已成功补全{{audioFileCountForMetadataInfoCompletedSuccess}}个音频文件的元数据信息。&#x000A;
× 未成功补全{{audioFileCountForMetadataInfoCompletedFailure}}个音频文件的元数据信息。"/>
    </bean>
    <!-- 分析和补全音乐信息配置 -->
    <bean id="analysingAndComplementsForAudioFileConfig" class="com.stevejrong.music.factory.config.sub.AnalysingAndComplementsForAudioFileConfig">
        <!-- 音频文件存放目录 -->
        <property name="audioFileDirectory" value="${musicFactory.base.audioFileDirectory}"/>
        <property name="audioFileMetadataResolvers">
            <map key-type="java.lang.String" value-type="java.lang.Object">
                <entry key="mp3">
                    <list>
                        <ref bean="mp3MetadataQueryResolver"/>
                        <ref bean="mp3MetadataPersistResolver"/>
                    </list>
                </entry>

                <entry key="flac">
                    <list>
                        <ref bean="flacMetadataQueryResolver"/>
                        <ref bean="flacMetadataPersistResolver"/>
                    </list>
                </entry>
            </map>
        </property>
    </bean>
    <bean id="audioFileFormatConversionConfig" class="com.stevejrong.music.factory.config.sub.AudioFileFormatConversionConfig">
        <!-- 转换后的音频文件存放目录 -->
        <property name="convertedAudioFileDirectory" value="${musicFactory.base.convert.convertedAudioFileDirectory}"/>
        <!-- FFmpeg组件配置 -->
        <property name="ffmpegComponentConfig" ref="ffmpegComponentConfig"/>
        <property name="audioFileConverters">
            <map key-type="java.lang.String" value-type="com.stevejrong.music.factory.spi.service.music.formatConversion.IAudioFileConverter">
                <entry key="m4a" value-ref="m4aAacToFlacConverter"/>
                <entry key="ape" value-ref="apeToFlacConverter"/>
                <entry key="wav" value-ref="wavToFlacConverter"/>
            </map>
        </property>
    </bean>

    <bean id="linuxOSForFFmpeg" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
        <property name="staticField" value="com.stevejrong.music.factory.common.enums.SupportOSForFFmpegEnum.LINUX"/>
    </bean>
    <bean id="microsoftWindowsNTOSForFFmpeg" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
        <property name="staticField" value="com.stevejrong.music.factory.common.enums.SupportOSForFFmpegEnum.MICROSOFT_WINDOWS_NT"/>
    </bean>
    <bean id="appleMacOSForFFmpeg" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
        <property name="staticField" value="com.stevejrong.music.factory.common.enums.SupportOSForFFmpegEnum.APPLE_MAC_OS"/>
    </bean>

    <bean id="ffmpegComponentConfig" class="com.stevejrong.music.factory.config.sub.FfmpegComponentConfig">
        <property name="ffmpegPathsByOSType">
            <map>
                <entry key-ref="microsoftWindowsNTOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffmpeg.forMicrosoftWindowsNTPath}"/>
                <entry key-ref="linuxOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffmpeg.forLinuxPath}"/>
                <entry key-ref="appleMacOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffmpeg.forAppleMacOSPath}"/>
            </map>
        </property>
        <property name="ffmprobePathsByOSType">
            <map>
                <entry key-ref="microsoftWindowsNTOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffprobe.forMicrosoftWindowsNTPath}"/>
                <entry key-ref="linuxOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffprobe.forLinuxPath}"/>
                <entry key-ref="appleMacOSForFFmpeg" value="${musicFactory.convert.ffmpegComponents.ffprobe.forAppleMacOSPath}"/>
            </map>
        </property>
    </bean>
    <!-- 系统配置 -->
    <bean id="systemConfig" class="com.stevejrong.music.factory.config.SystemConfig">
        <property name="baseConfig" ref="baseConfig"/>
        <property name="filterGroupsConfig">
            <list>
                <ref bean="${musicFactory.base.partner.songinfo.analyzingInfo.filterGroup.activeConfig}"/>
                <ref bean="${musicFactory.base.partner.songinfo.datasource.filterGroup.activeConfig}"/>
            </list>
        </property>
        <property name="analysingAndComplementsForAudioFileConfig" ref="analysingAndComplementsForAudioFileConfig"/>
        <property name="audioFileFormatConversionConfig" ref="audioFileFormatConversionConfig"/>
    </bean>

    <!--用于判断音频文件，是否需要信息补全的过滤器配置Bean-->
    <bean id="analyzingInfoForAudioFileFilterConfig" class="com.stevejrong.music.factory.config.sub.FilterGroupsConfig">
        <property name="filterGroupTag" value="analyzingInfoForAudioFileFilterConfig"/>
        <property name="redirectThisExecuteResultToNext" value="false"/>
        <property name="filters">
            <list>
                <ref bean="songTitleFilter"/>
                <ref bean="songArtistFilter"/>
                <ref bean="albumNameFilter"/>
                <ref bean="albumPictureFilter"/>
                <ref bean="songLyricsFilter"/>
                <ref bean="albumArtistFilter"/>
                <ref bean="albumPublishDateFilter"/>
                <ref bean="albumDescriptionFilter"/>
                <ref bean="albumLanguageFilter"/>
                <ref bean="albumCopyrightFilter"/>
            </list>
        </property>
    </bean>

    <!--酷狗音乐第三方音频元数据信息API请求过滤器配置Bean-->
    <bean id="kuGouMusicPartnerSongInfoDataSourceFilterConfig" class="com.stevejrong.music.factory.config.sub.FilterGroupsConfig">
        <property name="filterGroupTag" value="kuGouMusicPartnerSongInfoDataSourceFilterConfig"/>
        <property name="partnerSongInfoFilterCriteriaBean" ref="kuGouMusicPartnerSongInfoFilterCriteriaBean"/>
        <property name="partnerSongInfoResolverBean" ref="kuGouPartnerSongInfoResolver"/>
        <property name="redirectThisExecuteResultToNext" value="true"/>
        <property name="filters">
            <list>
                <ref bean="kuGouMusicPartnerSongInfoFilter_1"/>
                <ref bean="kuGouMusicPartnerSongInfoFilter_2"/>
                <ref bean="kuGouMusicPartnerSongInfoFilter_3"/>
            </list>
        </property>
    </bean>

    <!--Flac格式的音频文件，元数据解析器-->
    <bean id="flacMetadataQueryResolver" class="com.stevejrong.music.factory.provider.service.music.metadata.resolver.query.impl.FlacMetadataQueryResolver"/>
    <!--MP3格式的音频文件，元数据解析器-->
    <bean id="mp3MetadataQueryResolver" class="com.stevejrong.music.factory.provider.service.music.metadata.resolver.query.impl.Mp3MetadataQueryResolver"/>

    <!--酷狗音乐第三方音频服务平台，音频元数据解析器-->
    <bean id="kuGouPartnerSongInfoResolver" class="com.stevejrong.music.factory.provider.service.music.analyzing.partner.resolver.impl.KuGouPartnerSongInfoResolver"/>

    <!--Flac格式的音频文件，元数据存储器-->
    <bean id="flacMetadataPersistResolver" class="com.stevejrong.music.factory.provider.service.music.metadata.resolver.persist.impl.FlacMetadataPersistResolver"/>
    <!--MP3格式的音频文件，元数据存储器-->
    <bean id="mp3MetadataPersistResolver" class="com.stevejrong.music.factory.provider.service.music.metadata.resolver.persist.impl.Mp3MetadataPersistResolver"/>

    <!--酷狗音乐第三方音频服务平台音频元数据API请求Bean-->
    <bean id="kuGouMusicPartnerSongInfoFilter_1" class="com.stevejrong.music.factory.provider.service.music.analyzing.partner.datasource.impl.kugoumusic.KuGouMusicPartnerSongInfoFilter_1">
        <property name="order" value="1"/>
        <property name="status" value="true"/>
        <property name="requestUrl" value="${musicFactory.base.partner.songinfo.datasource.filterGroup.filters.kuGouMusicPartnerSongInfoDataSourceFilter.kuGouMusicPartnerSongInfoFilter_1.requestUrl}"/>
    </bean>
    <bean id="kuGouMusicPartnerSongInfoFilter_2" class="com.stevejrong.music.factory.provider.service.music.analyzing.partner.datasource.impl.kugoumusic.KuGouMusicPartnerSongInfoFilter_2">
        <property name="order" value="2"/>
        <property name="status" value="true"/>
        <property name="requestUrl" value="${musicFactory.base.partner.songinfo.datasource.filterGroup.filters.kuGouMusicPartnerSongInfoDataSourceFilter.kuGouMusicPartnerSongInfoFilter_2.requestUrl}"/>
    </bean>
    <bean id="kuGouMusicPartnerSongInfoFilter_3" class="com.stevejrong.music.factory.provider.service.music.analyzing.partner.datasource.impl.kugoumusic.KuGouMusicPartnerSongInfoFilter_3">
        <property name="order" value="3"/>
        <property name="status" value="true"/>
        <property name="requestUrl" value="${musicFactory.base.partner.songinfo.datasource.filterGroup.filters.kuGouMusicPartnerSongInfoDataSourceFilter.kuGouMusicPartnerSongInfoFilter_3.requestUrl}"/>
    </bean>
    <bean id="kuGouMusicPartnerSongInfoFilterCriteriaBean" class="com.stevejrong.music.factory.spi.music.bean.partner.kugoumusic.KuGouMusicPartnerSongInfoFilterCriteriaBean"/>

    <!-- M4A（AAC）音频格式转换为FLAC音频文件格式转换器 -->
    <bean id="m4aAacToFlacConverter" class="com.stevejrong.music.factory.provider.service.music.formatConversion.impl.M4aAacToFlacConverter">
        <property name="systemConfig" ref="systemConfig"/>
    </bean>
    <!-- APE音频格式转换为FLAC音频格式转换器 -->
    <bean id="apeToFlacConverter" class="com.stevejrong.music.factory.provider.service.music.formatConversion.impl.ApeToFlacConverter">
        <property name="systemConfig" ref="systemConfig"/>
    </bean>
    <!-- WAV音频格式转换为FLAC音频格式转换器 -->
    <bean id="wavToFlacConverter" class="com.stevejrong.music.factory.provider.service.music.formatConversion.impl.WavToFlacConverter">
        <property name="systemConfig" ref="systemConfig"/>
    </bean>

    <!--业务模块：音频文件信息分析-->
    <bean id="analyzingInfoForAudioFileModule" class="com.stevejrong.music.factory.provider.service.music.impl.AnalyzingInfoForAudioFileModule">
        <property name="systemConfig" ref="systemConfig"/>
    </bean>

    <!--业务模块：补全音乐元数据信息-->
    <bean id="complementsInfoForAudioFileModule" class="com.stevejrong.music.factory.provider.service.music.impl.ComplementsInfoForAudioFileModule">
        <property name="systemConfig" ref="systemConfig"/>
        <property name="partnerSongInfoDataSourceActiveConfigName" value="${musicFactory.base.partner.songinfo.datasource.filterGroup.activeConfig}"/>
    </bean>

    <!--业务模块：音频文件格式转换-->
    <bean id="audioFileFormatConversionModule" class="com.stevejrong.music.factory.provider.service.music.impl.AudioFileFormatConversionModule">
        <property name="systemConfig" ref="systemConfig"/>
        <!-- 某一种受支持的音频格式，转换为FLAC音频格式，其音频转换器的使用规则 -->
        <property name="rulesByMusicConverter">
            <map>
                <!-- M4A（AAC）音频格式转换为FLAC音频格式 -->
                <entry key="m4a_aac" value="m4aAacToFlacConverter"/>
                <!-- APE音频格式转换为FLAC音频格式 -->
                <entry key="ape" value="apeToFlacConverter"/>
                <!-- WAV音频格式转换为FLAC音频格式 -->
                <entry key="wav" value="wavToFlacConverter"/>
            </map>
        </property>
    </bean>

    <bean id="springBeanUtil" class="com.stevejrong.music.factory.common.util.SpringBeanUtil"/>

    <bean id="baseFilterChain" class="com.stevejrong.music.factory.spi.service.music.filter.BaseFilterChain"/>
    <!--音频文件信息分析时，需要补全音频信息的条件过滤器-->
    <!--歌曲标题过滤器-->
    <bean id="songTitleFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.SongTitleFilter">
        <property name="order" value="3"/>
        <property name="status" value="true"/>
    </bean>
    <!--歌曲艺术家过滤器-->
    <bean id="songArtistFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.SongArtistFilter">
        <property name="order" value="1"/>
        <property name="status" value="true"/>
    </bean>
    <!--歌曲所属的专辑名称过滤器-->
    <bean id="albumNameFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumNameFilter">
        <property name="order" value="4"/>
        <property name="status" value="true"/>
    </bean>
    <!--歌曲所属的专辑封面过滤器-->
    <bean id="albumPictureFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumPictureFilter">
        <property name="order" value="2"/>
        <property name="status" value="true"/>
    </bean>
    <!--歌曲内嵌歌词过滤器-->
    <bean id="songLyricsFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.SongLyricsFilter">
        <property name="order" value="6"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.songLyricsFilter}"/>
    </bean>
    <!--歌曲所属专辑的艺术家过滤器-->
    <bean id="albumArtistFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumArtistFilter">
        <property name="order" value="7"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.albumArtistFilter}"/>
    </bean>
    <!--歌曲所属专辑的发布时间过滤器-->
    <bean id="albumPublishDateFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumPublishDateFilter">
        <property name="order" value="8"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.albumPublishDateFilter}"/>
    </bean>
    <!--歌曲所属专辑的发布时间过滤器-->
    <bean id="albumDescriptionFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumDescriptionFilter">
        <property name="order" value="9"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.albumDescriptionFilter}"/>
    </bean>
    <!--歌曲所属专辑的语言类型过滤器-->
    <bean id="albumLanguageFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumLanguageFilter">
        <property name="order" value="10"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.albumLanguageFilter}"/>
    </bean>
    <!--歌曲所属专辑的版权信息过滤器-->
    <bean id="albumCopyrightFilter" class="com.stevejrong.music.factory.provider.service.music.analyzing.filter.impl.AlbumCopyrightFilter">
        <property name="order" value="11"/>
        <property name="status" value="${musicFactory.filters.analyzingInfoForAudioFile.albumCopyrightFilter}"/>
    </bean>

    <!-- 用于支持项目读取Yml/Yaml配置文件 -->
    <bean id="yamlProperties" class="org.springframework.beans.factory.config.YamlPropertiesFactoryBean">
        <property name="resources">
            <array>
                <value>classpath:custom-config.yml</value>
                <value>classpath:base-config.yml</value>
            </array>
        </property>
    </bean>
</beans>